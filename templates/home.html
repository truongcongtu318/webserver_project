<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">


    <title>file manager with folders recent files and members - Bootdey.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
       <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js"></script>
    <style type="text/css">
        body {
            margin-top: 20px;
            background-color: #f1f3f7;
        }

        .search-box .form-control {
            border-radius: 10px;
            padding-left: 40px
        }

        .search-box .search-icon {
            position: absolute;
            left: 13px;
            top: 50%;
            -webkit-transform: translateY(-50%);
            transform: translateY(-50%);
            fill: #545965;
            width: 16px;
            height: 16px
        }

        .card {
            margin-bottom: 24px;
            -webkit-box-shadow: 0 2px 3px #e4e8f0;
            box-shadow: 0 2px 3px #e4e8f0;
        }

        .card {
            position: relative;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            min-width: 0;
            word-wrap: break-word;
            background-color: #fff;
            background-clip: border-box;
            border: 1px solid #eff0f2;
            border-radius: 1rem;
        }

        .me-3 {
            margin-right: 1rem !important;
        }

        .font-size-24 {
            font-size: 24px !important;
        }

        .avatar-title {
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            background-color: #3b76e1;
            color: #fff;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            font-weight: 500;
            height: 100%;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            width: 100%;
        }

        .bg-soft-info {
            background-color: rgba(87, 201, 235, .25) !important;
        }

        .bg-soft-primary {
            background-color: rgba(59, 118, 225, .25) !important;
        }

        .avatar-xs {
            height: 1rem;
            width: 1rem
        }

        .avatar-sm {
            height: 2rem;
            width: 2rem
        }

        .avatar {
            height: 3rem;
            width: 3rem
        }

        .avatar-md {
            height: 4rem;
            width: 4rem
        }

        .avatar-lg {
            height: 5rem;
            width: 5rem
        }

        .avatar-xl {
            height: 6rem;
            width: 6rem
        }

        .avatar-title {
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            background-color: #3b76e1;
            color: #fff;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            font-weight: 500;
            height: 100%;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            width: 100%
        }

        .avatar-group {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            padding-left: 8px
        }

        .avatar-group .avatar-group-item {
            margin-left: -8px;
            border: 2px solid #fff;
            border-radius: 50%;
            -webkit-transition: all .2s;
            transition: all .2s
        }

        .avatar-group .avatar-group-item:hover {
            position: relative;
            -webkit-transform: translateY(-2px);
            transform: translateY(-2px)
        }

        .fw-medium {
            font-weight: 500;
        }

        a {
            text-decoration: none !important;
        }
    </style>
</head>
<body>
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/5.3.45/css/materialdesignicons.css"
      integrity="sha256-NAxhqDvtY0l4xn+YVa6WjAcmd94NNfttjNsDmNatFVc=" crossorigin="anonymous"/>
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<div class="container">
    <div class="row">
        <div class="col-xl-12">
            <div class="card">
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-lg-4 col-sm-6">
                            <div class="search-box mb-2 me-2">
                                <div class="position-relative">
                                    <input type="text" class="form-control bg-light border-light rounded"
                                           placeholder="Search...">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24"
                                         class="eva eva-search-outline search-icon">
                                        <g data-name="Layer 2">
                                            <g data-name="search">
                                                <rect width="24" height="24" opacity="0"></rect>
                                                <path d="M20.71 19.29l-3.4-3.39A7.92 7.92 0 0 0 19 11a8 8 0 1 0-8 8 7.92 7.92 0 0 0 4.9-1.69l3.39 3.4a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42zM5 11a6 6 0 1 1 6 6 6 6 0 0 1-6-6z"></path>
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-8 col-sm-6">
                            <div class="mt-4 mt-sm-0 d-flex align-items-center justify-content-sm-end">
                                <div class="mb-2 me-2">
                                    <div class="dropdown">
                                        <button class="btn btn-primary dropdown-toggle" type="button"
                                                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="mdi mdi-plus me-1"></i> Create New
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-end">
                                            <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                               data-bs-target="#createFolderModal">
                                                <i class="mdi mdi-folder-outline me-1"></i> Folder
                                            </a>
                                            <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                               data-bs-target="#uploadFileModal">
                                                <i class="mdi mdi-file-outline me-1"></i> Upload File
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                {#----------------------------------------------Model----------------------------------------------------#}
                                <!-- Modal tạo Folder -->
                                <div class="modal fade" id="createFolderModal" tabindex="-1"
                                     aria-labelledby="createFolderLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="createFolderLabel">Create New Folder</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <input type="text" class="form-control" placeholder="Folder Name"
                                                       id="folderName">
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                    Close
                                                </button>
                                                <button type="button" class="btn btn-primary" onclick="createFolder()">
                                                    Create Folder
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Modal tạo File -->
                                <div class="modal fade" id="uploadFileModal" tabindex="-1"
                                     aria-labelledby="uploadFileLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="uploadFileLabel">Upload File</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <input type="file" class="form-control" id="fileInput">
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                    Close
                                                </button>
                                                <button type="button" class="btn btn-primary" onclick="uploadFile()">
                                                    Upload File
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {#----------------------------------------------Model----------------------------------------------------#}
                                <div class="dropdown mb-0">
                                    <a class="btn btn-link text-muted dropdown-toggle p-1 mt-n2" role="button"
                                       data-bs-toggle="dropdown" aria-haspopup="true">
                                        <i class="mdi mdi-dots-vertical font-size-20"></i>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-end">
                                        <a class="dropdown-item" href="#">Share Files</a>
                                        <a class="dropdown-item" href="#">Share with me</a>
                                        <a class="dropdown-item" href="#">Other Actions</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5 class="font-size-16 me-3 mb-0">Folders</h5>
                    <div class="row mt-4">
                        <div class="col-xl-4 col-sm-6">
                            <div class="card shadow-none border">
                                <div class="card-body p-3">
                                    <div class>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="bx bxs-folder h1 mb-0 text-warning"></i>
                                            </div>
                                            <div class="avatar-group">
                                                <div class="avatar-group-item">
                                                    <a href="javascript: void(0);" class="d-inline-block">
                                                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png"
                                                             alt class="rounded-circle avatar-sm">
                                                    </a>
                                                </div>
                                                <div class="avatar-group-item">
                                                    <a href="javascript: void(0);" class="d-inline-block">
                                                        <img src="https://bootdey.com/img/Content/avatar/avatar2.png"
                                                             alt class="rounded-circle avatar-sm">
                                                    </a>
                                                </div>
                                                <div class="avatar-group-item">
                                                    <a href="javascript: void(0);" class="d-inline-block">
                                                        <div class="avatar-sm">
<span class="avatar-title rounded-circle bg-success text-white font-size-16">
A
</span>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex mt-3">
                                            <div class="overflow-hidden me-auto">
                                                <h5 class="font-size-15 text-truncate mb-1"><a
                                                        href="javascript: void(0);" class="text-body">Analytics</a></h5>
                                                <p class="text-muted text-truncate mb-0">12 Files</p>
                                            </div>
                                            <div class="align-self-end ms-2">
                                                <p class="text-muted mb-0 font-size-13"><i class="mdi mdi-clock"></i> 15
                                                    min ago</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-4 col-sm-6">
                            <div class="card shadow-none border">
                                <div class="card-body p-3">
                                    <div class>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="bx bxs-folder h1 mb-0 text-warning"></i>
                                            </div>
                                            <div class="avatar-group">
                                                <div class="avatar-group-item">
                                                    <a href="javascript: void(0);" class="d-inline-block">
                                                        <img src="https://bootdey.com/img/Content/avatar/avatar3.png"
                                                             alt class="rounded-circle avatar-sm">
                                                    </a>
                                                </div>
                                                <div class="avatar-group-item">
                                                    <a href="javascript: void(0);" class="d-inline-block">
                                                        <img src="https://bootdey.com/img/Content/avatar/avatar4.png"
                                                             alt class="rounded-circle avatar-sm">
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex mt-3">
                                            <div class="overflow-hidden me-auto">
                                                <h5 class="font-size-15 text-truncate mb-1"><a
                                                        href="javascript: void(0);" class="text-body">Sketch Design</a>
                                                </h5>
                                                <p class="text-muted text-truncate mb-0">235 Files</p>
                                            </div>
                                            <div class="align-self-end ms-2">
                                                <p class="text-muted mb-0 font-size-13"><i class="mdi mdi-clock"></i> 23
                                                    min ago</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-4 col-sm-6">
                            <div class="card shadow-none border">
                                <div class="card-body p-3">
                                    <div class>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="bx bxs-folder h1 mb-0 text-warning"></i>
                                            </div>
                                            <div class="avatar-group">
                                                <div class="avatar-group-item">
                                                    <a href="javascript: void(0);" class="d-inline-block">
                                                        <div class="avatar-sm">
<span class="avatar-title rounded-circle bg-info text-white font-size-16">
K
</span>
                                                        </div>
                                                    </a>
                                                </div>
                                                <div class="avatar-group-item">
                                                    <a href="javascript: void(0);" class="d-inline-block">
                                                        <img src="https://bootdey.com/img/Content/avatar/avatar5.png"
                                                             alt class="rounded-circle avatar-sm">
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex mt-3">
                                            <div class="overflow-hidden me-auto">
                                                <h5 class="font-size-15 text-truncate mb-1"><a
                                                        href="javascript: void(0);" class="text-body">Applications</a>
                                                </h5>
                                                <p class="text-muted text-truncate mb-0">20 Files</p>
                                            </div>
                                            <div class="align-self-end ms-2">
                                                <p class="text-muted mb-0 font-size-13"><i class="mdi mdi-clock"></i> 45
                                                    min ago</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="d-flex flex-wrap">
                        <h5 class="font-size-16 me-3">Recent Files</h5>
                        <div class="ms-auto">
                            <a href="javascript: void(0);" class="fw-medium text-reset">View All</a>
                        </div>
                    </div>
                    <hr class="mt-2">
                    <div class="table-responsive">
                        <table class="table align-middle table-nowrap table-hover mb-0">
                            <thead class="table-light">
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Date modified</th>
                                <th scope="col">Size</th>
                                <th scope="col" colspan="2">Members</th>
                            </tr>
                            </thead>
                            <tbody id="file-list">


                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
        getAllFiles();  // Gọi hàm lấy danh sách file khi trang được tải
    });
    
    function uploadFile() {
        var fileInput = document.getElementById('fileInput');
        var file = fileInput.files[0];
    
        if (!file) {
            Swal.fire('Lỗi!', 'Vui lòng chọn một file để tải lên.', 'error');
            return;
        }
    
        var formData = new FormData();
        formData.append('file', file);
    
        $.ajax({
            url: '/api/file/upload',
            type: 'POST',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('token')
            },
            data: formData,
            contentType: false,
            processData: false,
            success: function (response) {
                Swal.fire('Thành công!', response.message, 'success');
                getAllFiles();
                $('#uploadFileModal').modal('hide');
                fileInput.value = '';
            },
            error: function (err) {
                Swal.fire('Lỗi!', err.responseJSON.message, 'error');
            }
        });
    }
    
    function getAllFiles() {
        $.ajax({
            url: '/api/file/list',
            type: 'GET',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('token')
            },
            success: function (response) {
                const fileList = document.getElementById('file-list');
                fileList.innerHTML = '';
    
                response.files.forEach(file => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><a href="/api/file/download/${file.name}" class="text-dark fw-medium file-link" download>
                            <i class="mdi mdi-file-document font-size-16 align-middle text-primary me-2"></i>
                            ${file.name}</a></td>
                        <td>${file.uploaded_at || 'N/A'}</td>
                        <td>${file.size || 'N/A'}</td>
                        <td>
                            <div class="dropdown">
                                <a class="font-size-16 text-muted" role="button" data-bs-toggle="dropdown" aria-haspopup="true">
                                    <i class="mdi mdi-dots-horizontal"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a class="dropdown-item" href="/api/file/download/${file.name}" download>Tải xuống</a>
                                    <a class="dropdown-item" href="#" onclick="deleteFile(${file.id})">Xóa</a>
                                </div>
                            </div>
                        </td>
                    `;
                    fileList.appendChild(tr);
                });
            },
            error: function (err) {
                Swal.fire('Lỗi!', 'Không thể lấy danh sách file.', 'error');
            }
        });
    }
    function deleteFile(fileId) {
        Swal.fire({
            title: 'Bạn có chắc chắn?',
            text: "Bạn không thể hoàn tác hành động này!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Có, xóa nó!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: `/api/file/delete/${fileId}`,
                    type: 'DELETE',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    },
                    success: function(response) {
                        Swal.fire('Đã xóa!', 'File đã được xóa.', 'success');
                        getAllFiles();
                    },
                    error: function(err) {
                        Swal.fire('Lỗi!', 'Không thể xóa file.', 'error');
                    }
                });
            }
        });
    }
    
    document.addEventListener('click', function(e) {
        if (e.target.matches('.file-link') || e.target.matches('.dropdown-item[download]')) {
            e.preventDefault();
            const url = e.target.href;
            const token = localStorage.getItem('token');
            
            fetch(url, {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(response => {
                if (response.ok) return response.blob();
                throw new Error('Network response was not ok.');
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = e.target.textContent.trim();
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire('Lỗi!', 'Không thể tải xuống file.', 'error');
            });
        }
    });
</script>
</body>
</html>